---
output: html_document
---
# Mapping the Denver Housing Market


# Part Two: Exploration
## First Glances

Naturally, you are curious about the neighborhoods, no? The areas with the highest and lowest median values, as well as the areas with the best and worst value changes since 2010 - they are important to you, naturally!

Before going ahead, it is important to prepare the data. For various reasons, nine census tracts do not have a median housing value; thus, we must remove them from our analysis before we begin to show any correlations. So, let's do this!


```{r message=FALSE, warning=FALSE}


#################################
#

setwd('C:/Users/John/Denver_Housing_Project/ACS_Data/Final_Data')

load("ACSData9_14.RData")

table(is.na(ACSData9_14$Median_House_Value))

# Noticing nine missing observations of median housing value, and taking out 
test <- subset(ACSData9_14, is.na(Median_House_Value)) # So you can look at the 2 observations missing this variable
ACSData9_14nona <- subset(ACSData9_14, !is.na(Median_House_Value)) 
table(is.na(ACSData9_14nona$Median_House_Value)) #Now no NA's in median housing value


library(maptools)
library(rgdal)
library(sp)
library(ggplot2)
library(ggmap)
library(digest)
library(Hmisc)
gpclibPermit()
library(psych)
library(ggthemes)
library(plyr)
library(dplyr)
library(RColorBrewer)
library(colorspace)

```


First, you shrink the data to only the variables of interest and then arrange the data as you wish. Then, for the sake of exploring the margins, you decide to limit the results to the top twenty census tracts. (You also inspect the data frame to make sure it is ready.) 

Let us take a look!


```{r}

ACSData9_14nona.mhv <-ACSData9_14nona[c("Geography",
                  "JR_Name",
                  "County",
                  "Median_House_Value",
                  "Median_House_Value_2010",
                  "HouseValue_4YrChange")]


class(ACSData9_14nona.mhv)
class(ACSData9_14nona.mhv$Median_House_Value)

summary(ACSData9_14nona$Median_House_Value)
summary(ACSData9_14nona$Median_House_Value_2010)
summary(ACSData9_14nona$HouseValue_4YrChange)

```

Before digging in deeper, you take a peek at housing values in general. You discover a few things. First, you notice that, in general, the center of housing values tended to hover around $180,000 to $330,000. Second, you notice that (in a one-to-one comparison) most census tracts tended to grow slightly (up to 3.575%) or dip (down to -7.2%) and generally lose slight value (-1.0 to -1.7%).


```{r}

ACSData9_14nona.mhv %>%
  arrange(-Median_House_Value) %>%
  subset(Median_House_Value > 600000, select = c(Geography, JR_Name, County, Median_House_Value, Median_House_Value_2010, HouseValue_4YrChange))

```

So, which areas have the highest median housing values in 2014? 

First, you discover a high proportion (45%) of the tracts exist in Arapahoe County. In fact, four of them exist very closely to each other in the Cherry Hills Village and Greenwood Village areas! The top three, in fact, are capped off at $1,000,000 due to the Census Bureau survey question. It seems that what you heard about this part of Denver is, in fact, true.

Second, Denver County itself has a respectable percentage of areas as well (30%). 

```{r}

ACSData9_14nona.mhv %>%
  arrange(Median_House_Value) %>%
  subset(Median_House_Value < 108800, select = c(Geography, JR_Name, County, Median_House_Value, Median_House_Value_2010, HouseValue_4YrChange))

```

Which areas have the lowest median value in 2014? Adams County dominates this list at 60% of all tracts including the top 9! 

You see some areas in particular: Aurora most frequently, Federal Heights, and Thornton come up quickly. You are curious to know why this is the case but choose to explore later. 

You also notice what is not on the list. Neither Jefferson nor Douglas Counties have a city on this particular list. 


```{r}

ACSData9_14nona.mhv %>%
  arrange(-HouseValue_4YrChange) %>%
  subset(HouseValue_4YrChange >= 20.0, select = c(Geography, JR_Name, County, Median_House_Value, Median_House_Value_2010, HouseValue_4YrChange))

```

You also want to have a handle on changes in housing values from 2010 to 2014. You re-arrange the data to sort by four-year changes in median housing values.

Which areas grew the most in housing values from 2010 to 2014? Two areas in Adams County grew very quickly during this period: a tract in Berkley (199%) and one in Thornton (115%). You surmise that these might be newer developments, getting their footing comparatively late. Both areas have lower-than-average values, so this might be the case. 

You also notice Denver County tracts dominate this list, with 60% of the highest-growth tracts, while Jefferson County tracts appear nowhere. Is Jefferson a more mature market?

One interesting point comes to you as well. Among areas with the highest growth, there appears to be a healthy spread of housing values. Stated another way, while some of the hottest areas began as low-value areas in 2010 (certain tracts in Berkley, Thornton, Aurora), other tracts with very respectable growth exist with fairly high housing values. The Highland neighborhood in Denver County, for example, started at $251,600 in 2010 but jumped by 35% to $339,700 four years later. The Washington Park West neighborhood had a similar pattern, jumping 22.4% up to $484,800 in 2014. 


```{r}

ACSData9_14nona.mhv %>%
  arrange(-Median_House_Value_2010) %>%
  subset(Median_House_Value_2010 >= 444000, select = c(Geography, JR_Name, County, Median_House_Value, Median_House_Value_2010, HouseValue_4YrChange))

ACSData9_14nona.mhv %>%
  filter(Median_House_Value_2010 >= 444000 & Median_House_Value_2010 < 1000000) %>%
  ggplot(aes(x = Median_House_Value_2010, y = HouseValue_4YrChange)) +
  geom_point(alpha = 0.7) + stat_smooth(method = "lm")


```

You are also curious to see how the higher-value areas have performed since 2010, so you choose areas at the top tenth minimum ($444,000) and drop the highest areas ($1,000,000) for the graph because you do not have a reliable metric for four-year change (as noted above).

Upon reading the list, you notice a few things. First, three counties (Arapahoe, Douglas, and Denver) have most of the top-value neighborhoods (80%), with Jefferson holding most of the rest (19%). Second, Adams County only has one area, in Thornton/Todd Creek ($472,400 in 2010).

Third, upon reviewing the blue line in the graph, you notice a good dispersal of value change since 2010 but the general trend is slightly negative. 


```{r}


ACSData9_14nona.mhv %>%
  arrange(HouseValue_4YrChange) %>%
  subset(HouseValue_4YrChange < -22.0, select = c(Geography, JR_Name, County, Median_House_Value, Median_House_Value_2010, HouseValue_4YrChange))


```


## Correlations

For the sake of brevity, we will choose a subset of interesting variables and display them in a correlogram. You could choose to spit out individual pairwise correlations or even perhaps a multivariate table of correlations. However, with a correlogram [here, corrgram](https://cran.r-project.org/web/packages/corrgram/corrgram.pdf) you can display a multivariate chart of correlations, showing not only the direction but the magnitude as well!

(There is one quirk in using correlograms within R: it does not handle missing values well. In order to solve this problem, we whittled down the dataset by dropping missing values for the variables of interest, median housing values.)


```{r}

cor(ACSData9_14$Median_House_Value, ACSData9_14$Perc_18Plus, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$Perc_65Plus, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$MedianAge, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$Perc_Under18, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$Perc_20to29, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$Perc_30to39, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$Perc_40to49, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$Perc_50to59, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$Perc_60to69, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Perc35to50K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Perc35to50K_Owner, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Perc50to75K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Perc50to75K_Owner, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Perc75to100K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Perc75to100K_Owner, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Perc35KandBelow, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Owner_Perc35KandBelow, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Perc35Kto100K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Owner_Perc35Kto100K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Perc100KandAbove, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHInc12Mos_Owner_Perc100KandAbove, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHs_AvgFamilySize, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHs_AvgFamilySize_MarriedCoupleFamily, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHs_Total_PercOneUnitStructure, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHs_Total_UnitsinStructure_PercTwoPlusUnitStructure, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HHs_Perc_MarriedCoupleFamilyOnly, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_MedianAge, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_PercNotHSGrad, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_PercHSGradOnly, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_PercSomeCollegetoAA, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_PercBADegreeOnly, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_PercGradorProfDegree, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_IndIncome_Perc25to35K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_IndIncome_Perc35to50K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_IndIncome_Perc50to65K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_IndIncome_Perc65to75K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_IndIncome_Perc75KPlus, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_IndIncome_MedianIncome, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_PercBelow100PercPoverty, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_PercAtLeastHSGrad, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_PercAtLeastBADegree, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_IndIncome_PercUpto25K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_IndIncome_Perc25Kto75K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$SCs_PercUpto150PercentPovertyLevel, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$House_MedianYearBuilt, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$HousingUnits_Perc_Vacant, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$TvRO_Perc_Owner, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$TvRO_Perc_Renter, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$MeanHrsWorked, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$Same_School_Year_Ranking, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9_14$Median_House_Value, ACSData9_14$Last_School_Year_Ranking, use = "pairwise.complete.obs", method = c("pearson"))

ACSData9_14nona2 <-ACSData9_14nona[c("Median_House_Value",
                              "Perc_18Plus",
                              "Perc_65Plus",
                              "MedianAge",
                              "Perc_Under18",
                              "HHInc12Mos_Perc35to50K",
                              "HHInc12Mos_Perc35to50K_Owner",
                              "HHInc12Mos_Perc50to75K",
                              "HHInc12Mos_Perc50to75K_Owner",
                              "HHInc12Mos_Perc75to100K",
                              "HHInc12Mos_Perc75to100K_Owner",
                              "HHInc12Mos_Perc35KandBelow",
                              "HHInc12Mos_Owner_Perc35KandBelow",
                              "HHInc12Mos_Perc35Kto100K",
                              "HHInc12Mos_Owner_Perc35Kto100K",
                              "HHInc12Mos_Perc100KandAbove",
                              "HHInc12Mos_Owner_Perc100KandAbove",
                              "HHs_Perc_MarriedCoupleFamilyOnly",
                              "SCs_MedianAge",
                              "SCs_PercNotHSGrad",
                              "SCs_PercGradorProfDegree",
                              "SCs_IndIncome_Perc25to35K",
                              "SCs_IndIncome_Perc35to50K",
                              "SCs_IndIncome_Perc50to65K",
                              "SCs_IndIncome_Perc75KPlus",
                              "SCs_IndIncome_MedianIncome",
                              "SCs_PercAtLeastBADegree",
                              "SCs_IndIncome_PercUpto25K",
                              "SCs_IndIncome_Perc25Kto75K",
                              "SCs_IndIncome_Perc75KPlus",
                              "SCs_PercUpto150PercentPovertyLevel",
                              "TvRO_Perc_Renter",
                              "MeanHrsWorked",
                              "Same_School_Year_Ranking")]


library(corrgram)
corrgram(ACSData9_14nona2, order=NULL, 
         lower.panel=panel.shade,
         upper.panel=NULL,
         text.panel=panel.txt,
         main="Correlogram of data")

```


What do you discover from the fifty-two variables you have tried? For one thing, education matters. There are some strong findings: neighborhoods with a greater concentration of college graduates (and higher) tend to live in significantly more expensive housing areas (p = .77), and even higher for graduate/professional degrees (p = .795). Conversely, areas with higher rates of high school dropouts tend to have significantly lower housing values (p = -.534). On a related note, higher poverty - people living below 150% of the poverty rate - tends to correlate negatively with housing values (p = -.552).

Second, income levels can be important. There is a strong positive relationship between a neighborhood's individual income and housing values (p = .718), as well as house-owner households earning at least $75K (p = .761). There appears to be a strong negative pattern between middle-class income ($35 to $100K) and housing values, whether among house-owner households or households in general (p = -.747 and -.638). 

Third, individual and family characteristics are somewhat important. Older neighborhoods tend to have higher housing values, as do areas with a higher percentage of married couple families (p = .461 and .421). However, children and the elderly appear to have no effect on housing values. Also, the general age of houses do not seem to matter much at all (p = .238).

Despite the talk about the importance of schools, there is a more modest correlation with housing values (p = .365). 


## First Glances: Some Graphs

Perhaps it will help to show these things graphically. Here are a few representative relationships:


```{r}

library(plotly)
library(ggplot2)

qplot(x = Median_House_Value, data = ACSData9_14, binwidth = 4000,
      xlab = 'Median housing value',
      ylab = 'Number of neighborhoods')


```

One can notice, first, the fairly bell-shaped distribution to the data. Many neighborhoods have housing values ranging from $150K to $350K. Some neighborhoods south of the city of Denver have much higher values, some higher than the Bureau's survey.

Of course, you might wonder how neighborhood housing values have changed over time. As a way to do this, we have merged ACS neighborhood data from the 2005-2010 five-year estimates. Because the Census Bureau uses neighborhood samples of residents and households, it discourages any cross-time comparisons shorter than five years at a time. Also, because the Census Bureau changes some of its neighborhoods every decade, such data provide the best apples-to-apples comparison of neighborhoods.

```{r}

qplot(x = HouseValue_4YrChange, data = ACSData9_14, binwidth = 0.5,
      xlab = 'Five year change, median housing value',
      ylab = 'Number of neighborhoods')
describe(ACSData9_14$HouseValue_4YrChange)

```

One can notice in the second graph that the middle value of a neighborhood is far from uniform. Some areas experienced high growth rates - one as high as 119%, in fact! - likely due to its status as a new development area. There was, overall, a slight decline (mean of -1.03, median of -1.7)! While it is outside the scope of the project to explore this further at this time, it is nonetheless interesting to see.

One can suggest this is partly due to the methodology of the project: choosing random samples. Due to its sampling techniques, the Census Bureau itself does indeed caution against comparing its 2006-2010 and 2008-2012 ACS findings. However, they are less cautious when there is a five-year gap.


```{r}

p1 <- ggplot(aes(x = HHInc12Mos_Owner_Perc35KandBelow, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
           labs(x="Percent of Owners with Income below $35K", y="Median House Value")
p1 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

From here onward we will provide point graphs along with estimated regression lines (to highlight the best estimated pattern in the data).

Is it true that income can help drive neighborhood housing? You are curious to focus on housing owners rather than just the neighborhood at large, figuring this to be a better representation of an individual's choice to purchase.

You begin to notice a fairly modest negative relationship between the percent of owners earning below $35K and the neighborhood's median house value (-0.469). You might expect this, given that owners with such income are unlikely to afford a high-value house. 


```{r}
p2 <-ggplot(aes(x = HHInc12Mos_Owner_Perc35Kto100K, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
          labs(x="Percent of Owners with Income from $35K to $100K", y="Median House Value")
p2 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

As you search even further, you notice a fairly strong - but negative - relationship between mid-range incomes and median house values. If it is true, however, that a mortgage should not reach much further beyond 35% of one's gross income, let's take an example. Someone with an annual income of $70K can probably afford a $24K annual mortgage, which can translate to roughly $480K over 20 years (not adjusted for inflation). Thus, one can stretch far but only so far into the housing market.



```{r}
p3 <-ggplot(aes(x = HHInc12Mos_Owner_Perc100KandAbove, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
          labs(x="Percent of Owners with Income at Least $100K", y="Median House Value")
p3 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

You are curious and want to go further up the income ladder. Is there a relationship between higher-income owners and the houses they choose? You notice a stronger - and positive - relationship between higher incomes and higher housing values. High owner-income neighborhoods tend to have higher housing values. 


```{r}

p4 <-ggplot(aes(x = HHs_Perc_MarriedCoupleFamilyOnly, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
          labs(x="Percent of Households as Married-Couple Families", y="Median House Value")
p4 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

You wonder whether the overall neighborhood's demographics have an impact on local housing. It sounds right, no? One possibility is that stable families help undergird neighborhoods, which can thus help maintain or improve housing values.

You begin to consider this, as there appears a strong positive link between the percentage of married-couple families in an area and the median house value. While there are certainly a few exceptions, the trend seems clear.

```{r}

p5 <-ggplot(aes(x = SCs_IndIncome_MedianIncome, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
          labs(x="Median Individual Income", y="Median House Value")
p5 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

You also see a clear, positive link between the neighborhood's median individual income and housing values (p = .718). This is easy to defend, as people with higher incomes tend to have more financial resources, no? 


```{r}

p6 <-ggplot(aes(x = SCs_PercAtLeastBADegree, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
          labs(x="Percent of People with at Least Bachelor's Degree", y="Median House Value")
p6 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

With all the talk about the importance of education - college graduates earning more in their lifetimes than those without such a degree - you find macro-level support for this (p = .770). You also notice some areas tend to be even higher than anticipated. 


```{r}

p7 <-ggplot(aes(x = SCs_PercUpto150PercentPovertyLevel, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
          labs(x="Percent of People Living Below 150 Percent of Poverty Level", y="Median House Value")
p7 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

You also notice a link between poverty rates and housing values. Areas that tend to have higher poverty - or slightly above poverty - rates tend to have lower housing values (p = -.552). You wonder whether the relationship might be curvilinear.

```{r}

p8 <-ggplot(aes(x = House_MedianYearBuilt, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
          labs(x="Median Year House Built", y="Median House Value")
p8 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

You wonder whether housing values are partly a result of the 'age' of the houses themselves. Is it true that, as houses age, they decrease in relative value? Do newer houses tend to receive higher appreciation values? The results here suggest otherwise, as there does not appear to be a strong pattern in the data (p = .238). 


```{r}


p10 <-ggplot(aes(x = TvRO_Perc_Renter, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
          labs(x="Percent of Units Rented [vs. Owned]", y="Median House Value")
p10 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

You are also curious to see whether renting or owning has any impact on housing values. The results appear to be flat (p = -.340)

```{r}

p11 <-ggplot(aes(x = MeanHrsWorked, 
           y = Median_House_Value), data = ACSData9_14) +
           geom_point(alpha = .4) +
          labs(x="Person's Average Usual Hours Worked", y="Median House Value")
p11 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

```

You want to see whether the Great Recession had any long-lasting impact on neighborhood housing. You consider whether the average number of hours - as a proxy for employment status - is linked to housing values.

The results suggest otherwise, with a small correlation at best (p = .263). Of course, it can be partly a function of the survey, since the types (and payscales) of work people pursue can vary greatly. Alternately, it can also be considered a crude measure of the economic 'health' of a community.


```{r}

p12 <-ggplot(aes(x = Same_School_Year_Ranking, y = Median_House_Value), data = ACSData9_14) +
            geom_point(alpha = .4) + 
            labs(x="School District Ranking, Prior Year", y="Median House Value")
p13 <- p12 + stat_smooth(method = "lm", alpha = .2, size = 0.5)
p13 + geom_jitter(width=.08)

```


What you find is a relatively modest correlation between a school district's performance and housing values at best(p = 3655). This is a bit surprising, given all the talk about schools and educational performance. Of course, you are not drilling down into individual schools and you are not tracking individual moves within the metropolitan area. While it is possible to point to the importance of private schools, you know that the national average of private school attendance is only around 10 percent and Denver is not among the top 10 percent of large metropolitan areas for private school attendance. ([Source](http://www.citylab.com/housing/2014/08/where-private-school-enrollment-is-highest-and-lowest-across-the-us/375993))

# Part Three: Mapping
## Mapping Relationships Visually

### Preparing the Data 

Okay, so perhaps you - like many others - hate staring at graphs. It will make more sense to create visual maps instead. In this way, you can see how neighborhoods can vary - sometimes drastically! After all, visual maps are a powerful way to tell a data story, no?

Since you have been thinking about the downtown and immediate southern suburbs first, you have decided to narrow the maps thus.

Creating these types of maps takes two basic steps. First, we will use a simple yet accurate starting map to represent the Denver metropolitan area. For this stage of the project, Google's maps are sufficient.

Second, we shall find some geographic files to represent the boundaries of each census tract. The Census Bureau provides shapefiles for just such an occasion, providing polygon shapes.

Third, in order to represent our variables of interest, we shall merge the shapefiles into our dataset.

There are a few necessary technical steps in order to use the shapefiles. We must read the GEOID variable as a character vector, and then fortify them.
```

```{r}
#
#
#################################################################
#
#  Start mapping
#  Define map source type and color
#

DenverMetro <- c(-106, 40.3, -104, 39.1)
DenverMetroMap <- get_map(location=DenverMetro, source = "google", 
                          maptype = "roadmap", zoom = 11, crop=FALSE)


# Add polygons from tract file
# https://www.census.gov/geo/maps-data/data/cbf/cbf_tracts.html
setwd('C:/Users/John/Denver_Housing_Project/ACS_Data/Final_Data')
getwd()
tract <- readOGR(dsn=".", layer = "cb_2014_08_tract_500k")
tract@data$GEOID<-as.character(tract@data$GEOID)


# convert polygons to data.frame
Denver_tract<-fortify(tract, region = "GEOID") 
str(Denver_tract)
Denver_tract$id <-substring(Denver_tract$id, 2) # id had extra 0 to left

str(Denver_tract$id)

library(reshape) 
Denver_tract <-rename(Denver_tract, c('id'='id2'))



##########################################
#
# Join polygons to housing value data
#

Denver_tract$id <-as.character(Denver_tract$id)
ACSData9_14nona$id <-as.character(ACSData9_14nona$id)


ACSData10_14 <-left_join(Denver_tract, ACSData9_14nona, by=c('id')) 

save(ACSData10_14, file = "ACSData10.RData")


###########################
# 
# Plot median housing value
# 

describe(ACSData9_14$Median_House_Value, na.rm = TRUE)
quantile(ACSData9_14$Median_House_Value, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

# Plot median housing values

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = Median_House_Value),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .3968125, .330950, .2810125, .243100, .215150, .181900, .149325, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Median House Value by Census Tract, 2014')

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = Median_House_Value),
             data = ACSData10_14, alpha = .4, size = .2) + 
             scale_colour_brewer("RdYlGn") +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Median House Value by Census Tract, 2014')

#########################
#
# Plot change in median house value over four years
#

describe(ACSData9_14$HouseValue_4YrChange, na.rm = TRUE)
quantile(ACSData9_14$HouseValue_4YrChange, c(1,.875, .75, .625, .5, .375, .25, .125, 0), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HouseValue_4YrChange),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(200, 7.4, 2.7, 0.1, -1.8, -4.0, -7.5, -11.6, -50)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Five-Year Change in Median House Value, 2010-2014')


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HouseValue_4YrChange),
             data = ACSData10_14, alpha = .4, size = .2) +
            scale_colour_brewer(palette = "Purples") +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Five-Year Change in Median House Value, 2010-2014')


#########################
#
# Plot Low-income households
#

describe(ACSData9_14$HHInc12Mos_Owner_Perc35KandBelow, na.rm = TRUE)
quantile(ACSData9_14$HHInc12Mos_Owner_Perc35KandBelow, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHInc12Mos_Owner_Perc35KandBelow), data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .184, .14, .106, .0895, .071, .05, .031, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Owners with Household Income Below $35K')

##########################################
# 
# Plot middle-income values
#

describe(ACSData9_14$HHInc12Mos_Owner_Perc35Kto100K, na.rm = TRUE)
quantile(ACSData9_14$HHInc12Mos_Owner_Perc35Kto100K, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHInc12Mos_Owner_Perc35Kto100K), data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .548, .4805, .41675, .355, .313, .255, .189375, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Owners with Household Income from $35K to $100K')



##########################################
# 
# Plot upper-income values
#

describe(ACSData9_14$HHInc12Mos_Owner_Perc100KandAbove, na.rm = TRUE)
quantile(ACSData9_14$HHInc12Mos_Owner_Perc100KandAbove, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHInc12Mos_Owner_Perc100KandAbove),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .748, .68, .607875, .545, .47025, .372, .289375, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Owners with Household Income Above $100K')



##########################################
# 
# Plot married-couple values
#

describe(ACSData9_14$HHs_Perc_MarriedCoupleFamilyOnly, na.rm = TRUE)
quantile(ACSData9_14$HHs_Perc_MarriedCoupleFamilyOnly, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHs_Perc_MarriedCoupleFamilyOnly),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(100, .7175, .6265, .5455, .474, .42025, .355, .278, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Married Couple Families by Census Tract, 2014')

##########################################
# 
# Plot median individual income values
#

describe(ACSData9_14$SCs_IndIncome_MedianIncome, na.rm = TRUE)
quantile(ACSData9_14$SCs_IndIncome_MedianIncome, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = SCs_IndIncome_MedianIncome),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(108000, 50354.38, 43665.25, 39548.12, 34880.5, 30929.75, 25823.5, 22325.25, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Median Individual Income')

##########################################
# 
# Plot percent with college degree values
#

describe(ACSData9_14$SCs_PercAtLeastBADegree, na.rm = TRUE)
quantile(ACSData9_14$SCs_PercAtLeastBADegree, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = SCs_PercAtLeastBADegree),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .635125, .552, .475, .394, .313625, .23175, .135, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent of People with A College Degree or More')


##########################################
# 
# Plot percent of people below 150 percent poverty level values
#

describe(ACSData9_14$SCs_PercUpto150PercentPovertyLevel, na.rm = TRUE)
quantile(ACSData9_14$SCs_PercUpto150PercentPovertyLevel, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = SCs_PercUpto150PercentPovertyLevel),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .398, .3035, .217, .157, .11225, .082, .052, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Living Below 150 Perent Poverty Level')


##################################
#
# Plot median year built values
#

describe(ACSData9_14$House_MedianYearBuilt, na.rm = TRUE)
quantile(ACSData9_14$House_MedianYearBuilt, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)



ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = House_MedianYearBuilt),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(2016, 1999, 1990, 1984, 1978, 1974, 1967, 1958, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Median Year House Built by Census Tract, 2014')

####################################
# 
# Plot percent vacant data
#

describe(ACSData9_14$HousingUnits_Perc_Vacant, na.rm = TRUE)
quantile(ACSData9_14$HousingUnits_Perc_Vacant, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

# Plot percent vacant values


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HousingUnits_Perc_Vacant),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .09425, .073, .06, .048, .036, .0255, .012, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Housing Units Vacant by Census Tract, 2014')

####################################
# 
# Plot renter data

describe(ACSData9_14$TvRO_Perc_Renter, na.rm = TRUE)
quantile(ACSData9_14$TvRO_Perc_Renter, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

# Plot percent renter built values


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = TvRO_Perc_Renter),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .65697053, .51911798, .41133582, .31193581, .23761539, .15011655, .07952541, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Housing Units Rented by Census Tract, 2014')

####################################
#
# Plot mean hours worked past 12 months data
#

describe(ACSData9_14$MeanHrsWorked, na.rm = TRUE)
quantile(ACSData9_14$MeanHrsWorked, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

# Plot mean hours worked values


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = MeanHrsWorked),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .410125, .401, .396, .39, .385, .37875, .370875, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Avg Number of Weekly Hours Worked by Census Tract, 2013')

####################################
#
# Plot school district rank data

describe(ACSData9_14$Same_School_Year_Ranking, na.rm = TRUE)
quantile(ACSData9_14$Same_School_Year_Ranking, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = Same_School_Year_Ranking),
             data = ACSData10_14, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .763, .682, .59, .59, .558, .426, .294, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('School District State Rank by Census Tract, 2013')


```
