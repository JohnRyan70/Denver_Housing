


```{r}

# This project seeks to explore a long-standing question in real estate: why do some neighborhoods have higher housing prices than do others? 
# For many living in the United States, owning a house is part of the 'American Dream', a sign of material prosperity and success.
# This project focuses on the five-county Denver metropolitan area, an area with a diverse population and growth.

# Before 
library(maptools)
library(rgdal)
library(sp)
library(ggplot2)
library(ggmap)
library(digest)
library(Hmisc)
gpclibPermit()
library(psych)
library(ggthemes)
library(plyr)
library(dplyr)
library(RColorBrewer)
library(colorspace)


# The Census Bureau's American Community Survey (ACS) collects regularly-sampled survey data from neighborhoods across the country. Their five-year average (2009-2013) represents the best publicly-available data that offer more granular data than the county or city level.


setwd('C:/Users/John/Denver_Housing_Project/ACS_Data/Final_Data')

# The ACS data include the median self-reported house value, our variable of interest.
HouseValue_Median_13 <-read.csv('ACS_13_5YR_B25077_DHP.csv', stringsAsFactors = FALSE)
HouseValue_Median_13 <-select(HouseValue_Median_13, GEO.id2,
                                 County, HD01_VD01) %>%
  rename(id=GEO.id2, Median_House_Value=HD01_VD01)
HouseValue_Median_13 <- mutate(HouseValue_Median_13,
                                  id=as.character(id),
                                  County=as.character(County),
                                  Median_House_Value = as.numeric(Median_House_Value))

# Town or neighborhood description

Census2010_Neighborhoods <-read.csv('ACS_2010_Census_Tracts_Neighborhoods.csv', stringsAsFactors=FALSE)
Census2010_Neighborhoods <-select(Census2010_Neighborhoods, GEO.id2, GEO.display.label,
                                              Zillow_Name, JR_Name) %>%
  rename(id=GEO.id2, Geography=GEO.display.label)
Census2010_Neighborhoods <- mutate(Census2010_Neighborhoods,
                                  id=as.character(id),
                                  Geography=as.character(Geography),
                                  Zillow_Name=as.character(Zillow_Name),
                                  JR_Name = as.character(JR_Name))

HouseValue_Median_13 <-left_join(Census2010_Neighborhoods, HouseValue_Median_13, by=c("id")) 



# Age and sex variables
Age_Sex_13 <-read.csv('ACS_13_5YR_S0101_DHP.csv',  stringsAsFactors = FALSE)
Age_Sex_13 <-select(Age_Sex_13, 
                            GEO.id2, 
                            HC01_EST_VC01, HC01_EST_VC07, HC01_EST_VC08,
                            HC01_EST_VC09, HC01_EST_VC10, HC01_EST_VC11,
                            HC01_EST_VC12, HC01_EST_VC13, HC01_EST_VC14,
                            HC01_EST_VC15, HC01_EST_VC16, HC01_EST_VC28, 
                            HC01_EST_VC31, HC01_EST_VC35, HC02_EST_VC35, 
                            HC03_EST_VC35, HC01_EST_VC38, HC01_EST_VC39) %>%
  rename(id=GEO.id2, 
              TotalPop=HC01_EST_VC01,
              Perc_20to24=HC01_EST_VC07,
              Perc_25to29=HC01_EST_VC08,
              Perc_30to34=HC01_EST_VC09,
              Perc_35to39=HC01_EST_VC10,
              Perc_40to44=HC01_EST_VC11,
              Perc_45to49=HC01_EST_VC12,
              Perc_50to54=HC01_EST_VC13,
              Perc_55to59=HC01_EST_VC14,
              Perc_60to64=HC01_EST_VC15,
              Perc_65to69=HC01_EST_VC16,
              Perc_18Plus=HC01_EST_VC28,
              Perc_65Plus=HC01_EST_VC31,
              MedianAge=HC01_EST_VC35,
              MedianAge_Male=HC02_EST_VC35,
              MedianAge_Female=HC03_EST_VC35,
              OldAgeDependencyRatio=HC01_EST_VC38,
              ChildDependencyRatio=HC01_EST_VC39)

Age_Sex_13 <- mutate(Age_Sex_13,
                          id=as.character(id),
                          TotalPop=as.numeric(TotalPop),
                          Perc_20to24=as.numeric(Perc_20to24),
                          Perc_25to29=as.numeric(Perc_25to29),
                          Perc_30to34=as.numeric(Perc_30to34),
                          Perc_35to39=as.numeric(Perc_35to39),
                          Perc_40to44=as.numeric(Perc_40to44),
                          Perc_45to49=as.numeric(Perc_45to49),
                          Perc_50to54=as.numeric(Perc_50to54),
                          Perc_55to59=as.numeric(Perc_55to59),
                          Perc_60to64=as.numeric(Perc_60to64),
                          Perc_65to69=as.numeric(Perc_65to69),
                          Perc_18Plus=as.numeric(Perc_18Plus),
                          Perc_65Plus=as.numeric(Perc_65Plus),
                          MedianAge=as.numeric(MedianAge),
                          MedianAge_Male=as.numeric(MedianAge_Male),
                          MedianAge_Female=as.numeric(MedianAge_Female),
                          OldAgeDependencyRatio=as.numeric(OldAgeDependencyRatio),
                          ChildDependencyRatio=as.numeric(ChildDependencyRatio))

Age_Sex_13$Perc_Under18 <- 100 - (Age_Sex_13$Perc_18Plus)
Age_Sex_13$Perc_20to29 <- (Age_Sex_13$Perc_20to24 + Age_Sex_13$Perc_25to29)
Age_Sex_13$Perc_30to39 <- (Age_Sex_13$Perc_30to34 + Age_Sex_13$Perc_35to39)
Age_Sex_13$Perc_40to49 <- (Age_Sex_13$Perc_40to44 + Age_Sex_13$Perc_45to49)
Age_Sex_13$Perc_50to59 <- (Age_Sex_13$Perc_50to54 + Age_Sex_13$Perc_55to59)
Age_Sex_13$Perc_60to69 <- (Age_Sex_13$Perc_60to64 + Age_Sex_13$Perc_65to69)

str(Age_Sex_13)


# Financials - S2503
FinChars_13 <-read.csv('ACS_13_5YR_S2503_DHP2.csv',  stringsAsFactors = FALSE)
FinChars_13 <-select(FinChars_13, 
                            GEO.id2, 
                            HC01_EST_VC01, HC02_EST_VC01, HC01_EST_VC03,
                            HC02_EST_VC03, HC01_EST_VC04, HC02_EST_VC04,
                            HC01_EST_VC05, HC02_EST_VC05, HC01_EST_VC06,
                            HC02_EST_VC06, HC01_EST_VC07, HC02_EST_VC07,
                            HC01_EST_VC08, HC02_EST_VC08, HC01_EST_VC09,
                            HC02_EST_VC09, HC01_EST_VC10, HC02_EST_VC10,
                            HC01_EST_VC11, HC02_EST_VC11, HC01_EST_VC12,
                            HC02_EST_VC12, HC01_EST_VC13, HC02_EST_VC13) %>%
  rename(id=GEO.id2, 
          Houses_Total=HC01_EST_VC01,
          Houses_Owner=HC02_EST_VC01,
          HHInc12Mos_PercUnder5K=HC01_EST_VC03,
          HHInc12Mos_PercUnder5K_Owner=HC02_EST_VC03,
          HHInc12Mos_Perc5to9K=HC01_EST_VC04,
          HHInc12Mos_Perc5to9K_Owner=HC02_EST_VC04,
          HHInc12Mos_Perc10to14K=HC01_EST_VC05,
          HHInc12Mos_Perc10to14K_Owner=HC02_EST_VC05,
          HHInc12Mos_Perc15to20K=HC01_EST_VC06,
          HHInc12Mos_Perc15to20K_Owner=HC02_EST_VC06,
          HHInc12Mos_Perc20to25K=HC01_EST_VC07,
          HHInc12Mos_Perc20to25K_Owner=HC02_EST_VC07,
          HHInc12Mos_Perc25to35K=HC01_EST_VC08,
          HHInc12Mos_Perc25to35K_Owner=HC02_EST_VC08,
          HHInc12Mos_Perc35to50K=HC01_EST_VC09,
          HHInc12Mos_Perc35to50K_Owner=HC02_EST_VC09,
          HHInc12Mos_Perc50to75K=HC01_EST_VC10,
          HHInc12Mos_Perc50to75K_Owner=HC02_EST_VC10,
          HHInc12Mos_Perc75to100K=HC01_EST_VC11,
          HHInc12Mos_Perc75to100K_Owner=HC02_EST_VC11,
          HHInc12Mos_Perc100to150K=HC01_EST_VC12,
          HHInc12Mos_Perc100to150K_Owner=HC02_EST_VC12,
          HHInc12Mos_Perc150KPlus=HC01_EST_VC13,
          HHInc12Mos_Perc150KPlus_Owner=HC02_EST_VC13)


FinChars_13 <- mutate(FinChars_13, 
                                     id=as.character(id),
                          Houses_Total=as.numeric(Houses_Total),
                          Houses_Owner=as.numeric(Houses_Owner),
                          HHInc12Mos_PercUnder5K=as.numeric(HHInc12Mos_PercUnder5K),
                          HHInc12Mos_PercUnder5K_Owner=as.numeric(HHInc12Mos_PercUnder5K_Owner),
                          HHInc12Mos_Perc5to9K=as.numeric(HHInc12Mos_Perc5to9K),
                          HHInc12Mos_Perc5to9K_Owner=as.numeric(HHInc12Mos_Perc5to9K_Owner),
                          HHInc12Mos_Perc10to14K=as.numeric(HHInc12Mos_Perc10to14K),
                          HHInc12Mos_Perc10to14K_Owner=as.numeric(HHInc12Mos_Perc10to14K_Owner),
                          HHInc12Mos_Perc15to20K=as.numeric(HHInc12Mos_Perc15to20K),
                          HHInc12Mos_Perc15to20K_Owner=as.numeric(HHInc12Mos_Perc15to20K_Owner),
                          HHInc12Mos_Perc20to25K=as.numeric(HHInc12Mos_Perc20to25K),
                          HHInc12Mos_Perc20to25K_Owner=as.numeric(HHInc12Mos_Perc20to25K_Owner),
                          HHInc12Mos_Perc25to35K=as.numeric(HHInc12Mos_Perc25to35K),
                          HHInc12Mos_Perc25to35K_Owner=as.numeric(HHInc12Mos_Perc25to35K_Owner),
                          HHInc12Mos_Perc35to50K=as.numeric(HHInc12Mos_Perc35to50K),
                          HHInc12Mos_Perc35to50K_Owner=as.numeric(HHInc12Mos_Perc35to50K_Owner),
                          HHInc12Mos_Perc50to75K=as.numeric(HHInc12Mos_Perc50to75K),
                          HHInc12Mos_Perc50to75K_Owner=as.numeric(HHInc12Mos_Perc50to75K_Owner),
                          HHInc12Mos_Perc75to100K=as.numeric(HHInc12Mos_Perc75to100K),
                          HHInc12Mos_Perc75to100K_Owner=as.numeric(HHInc12Mos_Perc75to100K_Owner),
                          HHInc12Mos_Perc100to150K=as.numeric(HHInc12Mos_Perc100to150K),
                          HHInc12Mos_Perc100to150K_Owner=as.numeric(HHInc12Mos_Perc100to150K_Owner),
                          HHInc12Mos_Perc150KPlus=as.numeric(HHInc12Mos_Perc150KPlus),
                          HHInc12Mos_Perc150KPlus_Owner=as.numeric(HHInc12Mos_Perc150KPlus_Owner))


FinChars_13$HHInc12Mos_Perc25KandBelow <- (FinChars_13$HHInc12Mos_PercUnder5K + 
                                              FinChars_13$HHInc12Mos_Perc5to9K + 
                                              FinChars_13$HHInc12Mos_Perc10to14K + 
                                              FinChars_13$HHInc12Mos_Perc15to20K + 
                                              FinChars_13$HHInc12Mos_Perc20to25K)

FinChars_13$HHInc12Mos_Owner_Perc25KandBelow <- (FinChars_13$HHInc12Mos_PercUnder5K_Owner + 
                                                    FinChars_13$HHInc12Mos_Perc5to9K_Owner + 
                                                    FinChars_13$HHInc12Mos_Perc10to14K_Owner + 
                                                    FinChars_13$HHInc12Mos_Perc15to20K_Owner + 
                                                    FinChars_13$HHInc12Mos_Perc20to25K_Owner)


FinChars_13$HHInc12Mos_Perc25Kto75K<-(FinChars_13$HHInc12Mos_Perc25to35K + 
                                         FinChars_13$HHInc12Mos_Perc35to50K + 
                                         FinChars_13$HHInc12Mos_Perc50to75K)

FinChars_13$HHInc12Mos_Owner_Perc25Kto75K<-(FinChars_13$HHInc12Mos_Perc25to35K_Owner + 
                                               FinChars_13$HHInc12Mos_Perc35to50K_Owner + 
                                               FinChars_13$HHInc12Mos_Perc50to75K_Owner)

FinChars_13$HHInc12Mos_Perc75KandAbove <-(FinChars_13$HHInc12Mos_Perc75to100K + 
                                             FinChars_13$HHInc12Mos_Perc100to150K + 
                                             FinChars_13$HHInc12Mos_Perc150KPlus)

FinChars_13$HHInc12Mos_Owner_Perc75KandAbove <-(FinChars_13$HHInc12Mos_Perc75to100K_Owner + 
                                                   FinChars_13$HHInc12Mos_Perc100to150K_Owner + 
                                                   FinChars_13$HHInc12Mos_Perc150KPlus_Owner)


# Percent married couple family households
HHnFams_13<-read.csv('ACS_13_5YR_S1101_DHP.csv', stringsAsFactors = FALSE)
HHnFams_13 <-select(HHnFams_13, GEO.id2, 
                                HC01_EST_VC02, HC02_EST_VC02, HC05_EST_VC02,
                                HC01_EST_VC03, HC02_EST_VC03, HC05_EST_VC03,
                                HC01_EST_VC06, HC02_EST_VC06, HC05_EST_VC06,
                                HC01_EST_VC07, HC02_EST_VC07, HC05_EST_VC07,
                                HC01_EST_VC15, HC02_EST_VC15, HC05_EST_VC15,
                                HC01_EST_VC27, HC02_EST_VC27, HC05_EST_VC27,
                                HC01_EST_VC28, HC02_EST_VC28, HC05_EST_VC28,
                                HC01_EST_VC29, HC02_EST_VC29, HC05_EST_VC29) %>%
  rename(id=GEO.id2, 
          TotalHHs=HC01_EST_VC02,
          TotalHHs_MarriedCoupleFamily=HC02_EST_VC02,
          TotalHHs_Nonfamily=HC05_EST_VC02,
          HHs_AvgSize=HC01_EST_VC03,
          HHs_AvgSize_MarriedCoupleFamily=HC02_EST_VC03,
          HHs_AvgSize_Nonfamily=HC05_EST_VC03,
          HHs_TotalFamilies=HC01_EST_VC06,
          HHs_TotalFamilies_MarriedCoupleFamily=HC02_EST_VC06,
          HHs_TotalFamilies_Nonfamily=HC05_EST_VC06,
          HHs_AvgFamilySize=HC01_EST_VC07,
          HHs_AvgFamilySize_MarriedCoupleFamily=HC02_EST_VC07,
          HHs_AvgFamilySize_Nonfamily=HC05_EST_VC07,
          HHs_Total=HC01_EST_VC15,
          HHs_Total_MarriedCoupleFamily=HC02_EST_VC15,
          HHs_Total_Nonfamily=HC05_EST_VC15,
          HHs_Total_PercOneUnitStructure=HC01_EST_VC27,
          HHs_Total_UnitsinStructure_MarriedCoupleFamily_Perc_OneUnitStructure=HC02_EST_VC27,
          HHs_Total_UnitsinStructure_Nonfamily_Perc_OneUnitStructure=HC05_EST_VC27,
          HHs_Total_UnitsinStructure_PercTwoPlusUnitStructure=HC01_EST_VC28,
          HHs_Total_UnitsinStructure_MarriedCoupleFamily_Perc_TwoPlusUnitStructure=HC02_EST_VC28,
          HHs_Total_UnitsinStructure_Nonfamily_Perc_TwoPlusUnitStructure=HC05_EST_VC28,
          HHs_Total_UnitsinStructure_PercMobileHomeandSimilar=HC01_EST_VC29,
          HHs_Total_UnitsinStructure_MarriedCoupleFamily_Perc_MobileHomeandSimilar=HC02_EST_VC29,
          HHs_Total_UnitsinStructure_Nonfamily_Perc_MobileHomeandSimilar=HC05_EST_VC29)

HHnFams_13 <- mutate(HHnFams_13,
                      id=as.character(id),
                      TotalHHs=as.numeric(TotalHHs),
                      TotalHHs_MarriedCoupleFamily=as.numeric(TotalHHs_MarriedCoupleFamily),
                      TotalHHs_Nonfamily=as.numeric(TotalHHs_Nonfamily),
                      HHs_AvgSize=as.numeric(HHs_AvgSize),
                      HHs_AvgSize_MarriedCoupleFamily=as.numeric(HHs_AvgSize_MarriedCoupleFamily),
                      HHs_AvgSize_Nonfamily=as.numeric(HHs_AvgSize_Nonfamily),
                      HHs_TotalFamilies=as.numeric(HHs_TotalFamilies),
                      HHs_TotalFamilies_MarriedCoupleFamily=as.numeric(HHs_TotalFamilies_MarriedCoupleFamily),
                      HHs_TotalFamilies_Nonfamily=as.numeric(HHs_TotalFamilies_Nonfamily),
                      HHs_AvgFamilySize=as.numeric(HHs_AvgFamilySize),
                      HHs_AvgFamilySize_MarriedCoupleFamily=as.numeric(HHs_AvgFamilySize_MarriedCoupleFamily),
                      HHs_AvgFamilySize_Nonfamily=as.numeric(HHs_AvgFamilySize_Nonfamily),
                      HHs_Total=as.numeric(HHs_Total),
                      HHs_Total_MarriedCoupleFamily=as.numeric(HHs_Total_MarriedCoupleFamily),
                      HHs_Total_Nonfamily=as.numeric(HHs_Total_Nonfamily),
                      HHs_Total_PercOneUnitStructure=as.numeric(HHs_Total_PercOneUnitStructure),
                      HHs_Total_UnitsinStructure_MarriedCoupleFamily_Perc_OneUnitStructure=as.numeric(HHs_Total_UnitsinStructure_MarriedCoupleFamily_Perc_OneUnitStructure),
                      HHs_Total_UnitsinStructure_Nonfamily_Perc_OneUnitStructure=as.numeric(HHs_Total_UnitsinStructure_Nonfamily_Perc_OneUnitStructure),
                      HHs_Total_UnitsinStructure_PercTwoPlusUnitStructure=as.numeric(HHs_Total_UnitsinStructure_PercTwoPlusUnitStructure),
                      HHs_Total_UnitsinStructure_MarriedCoupleFamily_Perc_TwoPlusUnitStructure=as.numeric(HHs_Total_UnitsinStructure_MarriedCoupleFamily_Perc_TwoPlusUnitStructure),
                      HHs_Total_UnitsinStructure_Nonfamily_Perc_TwoPlusUnitStructure=as.numeric(HHs_Total_UnitsinStructure_Nonfamily_Perc_TwoPlusUnitStructure),
                      HHs_Total_UnitsinStructure_PercMobileHomeandSimilar=as.numeric(HHs_Total_UnitsinStructure_PercMobileHomeandSimilar),
                      HHs_Total_UnitsinStructure_MarriedCoupleFamily_Perc_MobileHomeandSimilar=as.numeric(HHs_Total_UnitsinStructure_MarriedCoupleFamily_Perc_MobileHomeandSimilar),
                      HHs_Total_UnitsinStructure_Nonfamily_Perc_MobileHomeandSimilar=as.numeric(HHs_Total_UnitsinStructure_Nonfamily_Perc_MobileHomeandSimilar))


HHnFams_13$HHs_Perc_MarriedCoupleFamilyOnly <-round(((HHnFams_13$TotalHHs_MarriedCoupleFamily/HHnFams_13$TotalHHs) * 100), digits = 1)

 

# Selected characteristics

SCs_13<-read.csv('ACS_13_5YR_S0601_DHP.csv',  stringsAsFactors = FALSE)
SCs_13 <-select(SCs_13, GEO.id2, 
                        HC01_EST_VC01, HC01_EST_VC12, HC01_EST_VC38,
                        HC01_EST_VC39, HC01_EST_VC40, HC01_EST_VC41,
                        HC01_EST_VC42, HC01_EST_VC45, HC01_EST_VC46,
                        HC01_EST_VC47, HC01_EST_VC48, HC01_EST_VC49,
                        HC01_EST_VC50, HC01_EST_VC53, HC01_EST_VC54,
                        HC01_EST_VC55, HC01_EST_VC56, HC01_EST_VC57, 
                        HC01_EST_VC58, HC01_EST_VC59, HC01_EST_VC60,
                        HC01_EST_VC61, HC01_EST_VC63, HC01_EST_VC66,
                        HC01_EST_VC67, HC01_EST_VC68) %>%
  rename(id=GEO.id2, 
          SCs_TotalPop=HC01_EST_VC01,
          SCs_MedianAge=HC01_EST_VC12,
          SCs_Marital_15YearsPlus_Total=HC01_EST_VC38,
          SCs_Marital_Perc_NeverMarried=HC01_EST_VC39,
          SCs_Marital_Perc_MarriedNotSeparated=HC01_EST_VC40, 
          SCs_Marital_Perc_DivorcedorSeparated=HC01_EST_VC41,
          SCs_Marital_Perc_Widowed=HC01_EST_VC42,
          SCs_EducationLevel_Total=HC01_EST_VC45,
          SCs_PercNotHSGrad=HC01_EST_VC46,
          SCs_PercHSGradOnly=HC01_EST_VC47,
          SCs_PercSomeCollegetoAA=HC01_EST_VC48,
          SCs_PercBADegreeOnly=HC01_EST_VC49,
          SCs_PercGradorProfDegree=HC01_EST_VC50,
          SCs_IndIncome_Total=HC01_EST_VC53,
          SCs_IndIncome_Perc1to10KorLess=HC01_EST_VC54,
          SCs_IndIncome_Perc10to15K=HC01_EST_VC55,
          SCs_IndIncome_Perc15to25K=HC01_EST_VC56,
          SCs_IndIncome_Perc25to35K=HC01_EST_VC57,
          SCs_IndIncome_Perc35to50K=HC01_EST_VC58,
          SCs_IndIncome_Perc50to65K=HC01_EST_VC59,
          SCs_IndIncome_Perc65to75K=HC01_EST_VC60,
          SCs_IndIncome_Perc75KPlus=HC01_EST_VC61,
          SCs_IndIncome_MedianIncome=HC01_EST_VC63,
          SCs_PovertyStatus_TotalPop=HC01_EST_VC66,
          SCs_PercBelow100PercPoverty=HC01_EST_VC67,
          SCs_Perc100to150PercPoverty=HC01_EST_VC68)

SCs_13 <- mutate(SCs_13, id=as.character(id),
                          SCs_TotalPop=as.numeric(SCs_TotalPop),
                          SCs_MedianAge=as.numeric(SCs_MedianAge),
                          SCs_Marital_15YearsPlus_Total=as.numeric(SCs_Marital_15YearsPlus_Total),
                          SCs_Marital_Perc_NeverMarried=as.numeric(SCs_Marital_Perc_NeverMarried),
                          SCs_Marital_Perc_MarriedNotSeparated=as.numeric(SCs_Marital_Perc_MarriedNotSeparated),
                          SCs_Marital_Perc_DivorcedorSeparated=as.numeric(SCs_Marital_Perc_DivorcedorSeparated),
                          SCs_Marital_Perc_Widowed=as.numeric(SCs_Marital_Perc_Widowed),
                          SCs_EducationLevel_Total=as.numeric(SCs_EducationLevel_Total),
                          SCs_PercNotHSGrad=as.numeric(SCs_PercNotHSGrad),
                          SCs_PercHSGradOnly=as.numeric(SCs_PercHSGradOnly),
                          SCs_PercSomeCollegetoAA=as.numeric(SCs_PercSomeCollegetoAA),
                          SCs_PercBADegreeOnly=as.numeric(SCs_PercBADegreeOnly),
                          SCs_PercGradorProfDegree=as.numeric(SCs_PercGradorProfDegree),
                          SCs_IndIncome_Total=as.numeric(SCs_IndIncome_Total),
                          SCs_IndIncome_Perc1to10KorLess=as.numeric(SCs_IndIncome_Perc1to10KorLess),
                          SCs_IndIncome_Perc10to15K=as.numeric(SCs_IndIncome_Perc10to15K),
                          SCs_IndIncome_Perc15to25K=as.numeric(SCs_IndIncome_Perc15to25K),
                          SCs_IndIncome_Perc25to35K=as.numeric(SCs_IndIncome_Perc25to35K),
                          SCs_IndIncome_Perc35to50K=as.numeric(SCs_IndIncome_Perc35to50K),
                          SCs_IndIncome_Perc50to65K=as.numeric(SCs_IndIncome_Perc50to65K),
                          SCs_IndIncome_Perc65to75K=as.numeric(SCs_IndIncome_Perc65to75K),
                          SCs_IndIncome_Perc75KPlus=as.numeric(SCs_IndIncome_Perc75KPlus),
                          SCs_IndIncome_MedianIncome=as.numeric(SCs_IndIncome_MedianIncome),
                          SCs_PovertyStatus_TotalPop=as.numeric(SCs_PovertyStatus_TotalPop),
                          SCs_PercBelow100PercPoverty=as.numeric(SCs_PercBelow100PercPoverty),
                          SCs_Perc100to150PercPoverty=as.numeric(SCs_Perc100to150PercPoverty))


SCs_13$SCs_IndIncome_PercTotal <- SCs_13$SCs_IndIncome_Perc1to10KorLess +
          SCs_13$SCs_IndIncome_Perc10to15K +
          SCs_13$SCs_IndIncome_Perc15to25K +  
          SCs_13$SCs_IndIncome_Perc25to35K +
          SCs_13$SCs_IndIncome_Perc35to50K +
          SCs_13$SCs_IndIncome_Perc50to65K +
          SCs_13$SCs_IndIncome_Perc65to75K +
          SCs_13$SCs_IndIncome_Perc75KPlus
          

SCs_13$SCs_PercAtLeastHSGrad <-SCs_13$SCs_PercHSGrad + 
          SCs_13$SCs_PercSomeCollegetoAA + 
          SCs_13$SCs_PercBADegreeOnly + 
          SCs_13$SCs_PercGradorProfDegree

SCs_13$SCs_PercAtLeastBADegree <- SCs_13$SCs_PercBADegreeOnly + 
          SCs_13$SCs_PercGradorProfDegree

SCs_13$SCs_IndIncome_PercUpto25K <- SCs_13$SCs_IndIncome_Perc1to10KorLess + 
          SCs_13$SCs_IndIncome_Perc10to15K +
          SCs_13$SCs_IndIncome_Perc15to25K

SCs_13$SCs_IndIncome_Perc25Kto75K <- SCs_13$SCs_IndIncome_Perc25to35K +
          SCs_13$SCs_IndIncome_Perc35to50K +
          SCs_13$SCs_IndIncome_Perc50to65K +
          SCs_13$SCs_IndIncome_Perc65to75K

SCs_13$SCs_PercUpto150PercentPovertyLevel <-SCs_13$SCs_PercBelow100PercPoverty + 
          SCs_13$SCs_Perc100to150PercPoverty

str(SCs_13)


# Median year built
MedianHouseYr_13<-read.csv('ACS_13_5YR_B25035_DHP.csv', stringsAsFactors = FALSE)
MedianHouseYr_13 <-select(MedianHouseYr_13, GEO.id2, HD01_VD01) %>%
  rename(id=GEO.id2, House_MedianYearBuilt=HD01_VD01)
MedianHouseYr_13 <- mutate(MedianHouseYr_13, id=as.character(id),
                     House_MedianYearBuilt=as.numeric(House_MedianYearBuilt))


# Percent vacant
OSH_13<-read.csv('ACS_13_5YR_B25002_DHP.csv', stringsAsFactors = FALSE, header=TRUE)
OSH_13 <-select(OSH_13, GEO.id2, 
           HD01_VD01, HD01_VD03) %>%
  rename(id=GEO.id2,
         HousingUnits_Total=HD01_VD01,
         HousingUnits_Vacant=HD01_VD03)
OSH_13 <- mutate(OSH_13, id=as.character(id),
                         HousingUnits_Total=as.numeric(HousingUnits_Total),
                         HousingUnits_Vacant=as.numeric(HousingUnits_Vacant))

OSH_13$HousingUnits_Perc_Vacant <- round(((OSH_13$HousingUnits_Vacant/OSH_13$HousingUnits_Total) * 100), digits = 1)


# Percent owned, and renting
TvRO_13<-read.csv('ACS_13_5YR_B25003_DHP.csv', stringsAsFactors = FALSE)
TvRO_13 <-select(TvRO_13, GEO.id2, 
                        HD01_VD01, HD01_VD02, HD01_VD03) %>%
  rename(id=GEO.id2, 
         TvRO_Total=HD01_VD01,
         TvRO_Owner=HD01_VD02,
         TvRO_Renter=HD01_VD03)

TvRO_13 <- mutate(TvRO_13, id=as.character(id),
                            TvRO_Total=as.numeric(TvRO_Total),
                            TvRO_Owner=as.numeric(TvRO_Owner),
                            TvRO_Renter=as.numeric(TvRO_Renter))

TvRO_13$TvRO_Perc_Owner <- round(((TvRO_13$TvRO_Owner/TvRO_13$TvRO_Total) * 100), digits = 1)
TvRO_13$TvRO_Perc_Renter <- TvRO_13$TvRO_Renter/TvRO_13$TvRO_Total * 100

str(TvRO_13$TvRO_Perc_Owner)
# Mean hours worked past 12 months

WorkPast12Mos_13<-read.csv('ACS_13_5YR_S2303_DHP.csv', stringsAsFactors = FALSE)
WorkPast12Mos_13 <-select(WorkPast12Mos_13, GEO.id2, HC01_EST_VC22) %>%
  rename(id=GEO.id2, MeanHrsWorked=HC01_EST_VC22)
WorkPast12Mos_13 <- mutate(WorkPast12Mos_13, id=as.character(id),
                                              MeanHrsWorked=as.numeric(MeanHrsWorked))

# School district rankings

SchlDistStateRank_1213 <-read.csv('School_District_Rankings_1213.csv', stringsAsFactors = FALSE)
SchlDistStateRank_1213 <-select(SchlDistStateRank_1213, GEO.id2,
                                       Schl_Dist_Rank_2012_13, Schl_Dist_Rank_2011_12) %>%
  rename(id=GEO.id2, 
         Same_School_Year_Ranking=Schl_Dist_Rank_2012_13,
         Last_School_Year_Ranking=Schl_Dist_Rank_2011_12)
SchlDistStateRank_1213 <- mutate(SchlDistStateRank_1213, id=as.character(id),
                                  Same_School_Year_Ranking=as.numeric(Same_School_Year_Ranking),
                                  Last_School_Year_Ranking=as.numeric(Last_School_Year_Ranking))


# Joining files



ACSData1<-left_join(HouseValue_Median_13, Age_Sex_13, by=c("id")) 
ACSData2<-left_join(ACSData1, FinChars_13, by=c("id")) 
ACSData3<-left_join(ACSData2, HHnFams_13, by=c("id")) 
ACSData4<-left_join(ACSData3, SCs_13, by=c("id")) 
ACSData5<-left_join(ACSData4, MedianHouseYr_13, by=c("id")) 
ACSData6<-left_join(ACSData5, OSH_13, by=c("id")) 
ACSData7<-left_join(ACSData6, TvRO_13, by=c("id")) 
ACSData8<-left_join(ACSData7, WorkPast12Mos_13, by=c("id")) 
ACSData9<-left_join(ACSData8, SchlDistStateRank_1213, by=c("id")) 

str(ACSData9)

# Try correlations of interesting variables

cor(ACSData9$Median_House_Value, ACSData9$Perc_18Plus, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$Perc_65Plus, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$MedianAge, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$OldAgeDependencyRatio, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$ChildDependencyRatio, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$Perc_Under18, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$Perc_20to29, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$Perc_30to39, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$Perc_40to49, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$Perc_50to59, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$Perc_60to69, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Perc35to50K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Perc35to50K_Owner, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Perc50to75K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Perc50to75K_Owner, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Perc75to100K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Perc75to100K_Owner, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Perc25KandBelow, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Owner_Perc25KandBelow, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Perc25Kto75K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Owner_Perc25Kto75K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Perc75KandAbove, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHInc12Mos_Owner_Perc75KandAbove, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHs_AvgFamilySize, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHs_AvgFamilySize_MarriedCoupleFamily, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHs_Total_PercOneUnitStructure, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHs_Total_UnitsinStructure_PercTwoPlusUnitStructure, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HHs_Perc_MarriedCoupleFamilyOnly, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_MedianAge, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_PercNotHSGrad, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_PercHSGradOnly, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_PercSomeCollegetoAA, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_PercBADegreeOnly, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_PercGradorProfDegree, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_IndIncome_Perc25to35K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_IndIncome_Perc35to50K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_IndIncome_Perc50to65K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_IndIncome_Perc65to75K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_IndIncome_Perc75KPlus, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_IndIncome_MedianIncome, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_PercBelow100PercPoverty, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_PercAtLeastHSGrad, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_PercAtLeastBADegree, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_IndIncome_PercUpto25K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_IndIncome_Perc25Kto75K, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_IndIncome_Perc75KPlus, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$SCs_PercUpto150PercentPovertyLevel, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$House_MedianYearBuilt, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$HousingUnits_Perc_Vacant, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$TvRO_Perc_Owner, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$TvRO_Perc_Renter, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$MeanHrsWorked, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$Same_School_Year_Ranking, use = "pairwise.complete.obs", method = c("pearson"))
cor(ACSData9$Median_House_Value, ACSData9$Last_School_Year_Ranking, use = "pairwise.complete.obs", method = c("pearson"))


# A few graphs for relationships

library(plotly)
library(ggplot2)

qplot(x = Median_House_Value, data = ACSData9, binwidth = 5000,
      xlab = 'Number of neighborhoods',
      ylab = 'Median housing value')


p1 <- ggplot(aes(x = HHInc12Mos_Owner_Perc25KandBelow, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
           labs(x="Percent of Owners with Income below $25K", y="Median House Value")
p1 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p2 <-ggplot(aes(x = HHInc12Mos_Owner_Perc25Kto75K, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Percent of Owners with Income from $25K to $75K", y="Median House Value")
p2 + stat_smooth(method = "lm", alpha = .2, size = 0.5)


p3 <-ggplot(aes(x = HHInc12Mos_Owner_Perc75KandAbove, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Percent of Owners with Income at Least $75K", y="Median House Value")
p3 + stat_smooth(method = "lm", alpha = .2, size = 0.5)


p4 <-ggplot(aes(x = HHs_Perc_MarriedCoupleFamilyOnly, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Percent of Households as Married-Couple Families", y="Median House Value")
p4 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p5 <-ggplot(aes(x = SCs_IndIncome_MedianIncome, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Median Individual Income", y="Median House Value")
p5 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p6 <-ggplot(aes(x = SCs_PercAtLeastBADegree, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Percent of People with at Least Bachelor's Degree", y="Median House Value")
p6 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p7 <-ggplot(aes(x = SCs_PercUpto150PercentPovertyLevel, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Percent of People Living Below 150 Percent of Poverty Level", y="Median House Value")
p7 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p8 <-ggplot(aes(x = House_MedianYearBuilt, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Median Year House Built", y="Median House Value")
p8 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p9 <-ggplot(aes(x = HousingUnits_Perc_Vacant, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Percent of Housing Units as Vacant", y="Median House Value")
p9 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p10 <-ggplot(aes(x = TvRO_Perc_Renter, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Percent of Units Rented [vs. Owned]", y="Median House Value")
p10 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p11 <-ggplot(aes(x = MeanHrsWorked, 
           y = Median_House_Value), data = ACSData9) +
           geom_point(alpha = .4) +
          labs(x="Person's Average Usual Hours Worked", y="Median House Value")
p11 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p12 <-ggplot(aes(x = Same_School_Year_Ranking, y = Median_House_Value), data = ACSData9) +
            geom_point(alpha = .4) + 
            labs(x="School District Ranking, Same Year", y="Median House Value")
p12 + stat_smooth(method = "lm", alpha = .2, size = 0.5)

p13 <-ggplot(aes(x = Last_School_Year_Ranking, y = Median_House_Value), data = ACSData9) +
            geom_point(alpha = .4) + 
            labs(x="School District Ranking, Previous Year", y="Median House Value")
p13 + stat_smooth(method = "lm", alpha = .2, size = 0.5)


#
#
#################################################################
#
#  Start mapping
#  Define map source type and color
#

DenverMetro <- c(-106, 40.3, -104, 39.1)
DenverMetroMap <- get_map(location=DenverMetro, source = "google", 
                          maptype = "roadmap", zoom = 11, crop=FALSE)
ggmap(DenverMetroMap)


# Add polygons from tract file
# https://www.census.gov/geo/maps-data/data/cbf/cbf_tracts.html
setwd('C:/Users/John/Denver_Housing_Project/ACS_Data/Final_Data')
getwd()
tract <- readOGR(dsn=".", layer = "cb_2014_08_tract_500k")
tract@data$GEOID<-as.character(tract@data$GEOID)


# convert polygons to data.frame
Denver_tract<-fortify(tract, region = "GEOID") 
str(Denver_tract)
Denver_tract$id <-substring(Denver_tract$id, 2) # id had extra 0 to left

str(Denver_tract$id)

library(reshape) 
Denver_tract <-rename(Denver_tract, c('id'='id2'))



##########################################
#
# Join polygons to housing value data
#

Denver_tract$id <-as.character(Denver_tract$id)
ACSData9$id <-as.character(ACSData9$id)


ACSData10 <-left_join(Denver_tract, ACSData9, by=c('id')) 
str(ACSData10)

save(ACSData9, file = "ACSData9.RData")
save(ACSData10, file = "ACSData10.RData")


###########################
# 
# Plot median housing value
# 

describe(ACSData10$Median_House_Value, na.rm = TRUE)
quantile(ACSData10$Median_House_Value, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

# Plot median housing values

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = Median_House_Value),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .449900, .383700, .331300, .273400, .241200, .209000, .159800, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Median House Value by Census Tract, 2013')

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = Median_House_Value),
             data = ACSData10, alpha = .4, size = .2) +
            scale_colour_brewer(palette = "Purples") +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Median House Value by Census Tract, 2013')

#########################
#
# Plot Low-income households
#

describe(ACSData10$HHInc12Mos_Owner_Perc25KandBelow, na.rm = TRUE)
quantile(ACSData10$HHInc12Mos_Owner_Perc25KandBelow, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHInc12Mos_Owner_Perc25KandBelow), data = ACSData10, color="black", alpha = .4, size = .2)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHInc12Mos_Owner_Perc25KandBelow), data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .182625, .137, .105, .089, .07, .04975, .031, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Owners with Household Income Below $25K')

##########################################
# 
# Plot middle-income values
#

describe(ACSData10$HHInc12Mos_Owner_Perc25Kto75K, na.rm = TRUE)
quantile(ACSData10$HHInc12Mos_Owner_Perc25Kto75K, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHInc12Mos_Owner_Perc25Kto75K), data = ACSData10, color="black", alpha = .4, size = .2)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHInc12Mos_Owner_Perc25Kto75K), data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .559, .482, .425875, .367, .319125, .264, .200375, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Owners with Household Income from $25K to $75K')



##########################################
# 
# Plot upper-income values
#

describe(ACSData10$HHInc12Mos_Owner_Perc75KandAbove, na.rm = TRUE)
quantile(ACSData10$HHInc12Mos_Owner_Perc75KandAbove, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHInc12Mos_Owner_Perc75KandAbove),
             data = ACSData10, color="black", alpha = .4, size = .2)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHInc12Mos_Owner_Perc75KandAbove),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .735625, .673250, .600875, .541, .45325, .38175, .266, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Owners with Household Income Above $75K')



##########################################
# 
# Plot married-couple values
#

describe(ACSData10$HHs_Perc_MarriedCoupleFamilyOnly, na.rm = TRUE)
quantile(ACSData10$HHs_Perc_MarriedCoupleFamilyOnly, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHs_Perc_MarriedCoupleFamilyOnly),
             data = ACSData10, color="black", alpha = .4, size = .2)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HHs_Perc_MarriedCoupleFamilyOnly),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(100, .7139986, .6287926, .5412984, .4774722, .4193193, .3575155, .2693803, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Married Couple Families by Census Tract, 2013')

##########################################
# 
# Plot median individual income values
#

describe(ACSData10$SCs_IndIncome_MedianIncome, na.rm = TRUE)
describe(ACSData9$SCs_IndIncome_MedianIncome, na.rm = TRUE)
describe(SCs_13$SCs_IndIncome_MedianIncome, na.rm = TRUE)

quantile(ACSData10$SCs_IndIncome_MedianIncome, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)
quantile(SCs_13$SCs_IndIncome_MedianIncome, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = SCs_IndIncome_MedianIncome),
             data = ACSData10, color="black", alpha = .4, size = .2)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = SCs_IndIncome_MedianIncome),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(108000, 50190.5, 43077.5, 38849.5, 34052, 30669, 26064, 21449.5, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Median Individual Income')

##########################################
# 
# Plot percent with college degree values
#

describe(ACSData10$SCs_PercAtLeastBADegree, na.rm = TRUE)
quantile(ACSData10$SCs_PercAtLeastBADegree, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = SCs_PercAtLeastBADegree),
             data = ACSData10, color="black", alpha = .4, size = .2)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = SCs_PercAtLeastBADegree),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .626, .55, .469, .386, .301, .2305, .137, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent of People with A College Degree or More')


##########################################
# 
# Plot percent of people below 150 percent poverty level values
#

describe(ACSData10$SCs_PercUpto150PercentPovertyLevel, na.rm = TRUE)
quantile(ACSData10$SCs_PercUpto150PercentPovertyLevel, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)
ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = SCs_PercUpto150PercentPovertyLevel),
             data = ACSData10, color="black", alpha = .4, size = .2)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = SCs_PercUpto150PercentPovertyLevel),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .39925, .3045, .21975, .159, .118, .0785, .05075, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Living Below 150 Perent Poverty Level')


##################################
#
# Plot median year built values
#

describe(ACSData10$House_MedianYearBuilt, na.rm = TRUE)
quantile(ACSData10$House_MedianYearBuilt, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = House_MedianYearBuilt),
             data = ACSData10, color="black", alpha = .4, size = .2)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = House_MedianYearBuilt),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(2016, 2002, 1996, 1989, 1984, 1978, 1972, 1962, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Median Year House Built by Census Tract, 2013')

####################################
# 
# Plot percent vacant data
#

describe(ACSData10$HousingUnits_Perc_Vacant, na.rm = TRUE)
quantile(ACSData10$HousingUnits_Perc_Vacant, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

# Plot percent vacant values
ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HousingUnits_Perc_Vacant),
             data = ACSData10, color="black", alpha = .4, size = .2)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = HousingUnits_Perc_Vacant),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .112186, .0865384, .070072, .05555555, .0427586, .0305454, .0157255, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Housing Units Vacant by Census Tract, 2013')

####################################
# 
# Plot renter data

describe(ACSData10$TvRO_Perc_Renter, na.rm = TRUE)
quantile(ACSData10$TvRO_Perc_Renter, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

# Plot percent renter built values
ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = TvRO_Perc_Renter),
             data = ACSData10, color="black", alpha = .4, size = .2)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = TvRO_Perc_Renter),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .55385, .412833, .29147, .207485, .1540913, .097891, .057106, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Percent Housing Units Rented by Census Tract, 2013')

####################################
#
# Plot mean hours worked past 12 months data
#

describe(ACSData10$MeanHrsWorked, na.rm = TRUE)
quantile(ACSData10$MeanHrsWorked, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

# Plot mean hours worked values

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = MeanHrsWorked),
             data = ACSData10, color="black", alpha = .4, size = .2)


ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = MeanHrsWorked),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .412, .402, .399, .394, .388, .382, .374, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('Avg Number of Weekly Hours Worked by Census Tract, 2013')

####################################
#
# Plot school district rank data

describe(ACSData10$Same_School_Year_Ranking, na.rm = TRUE)
quantile(ACSData10$Same_School_Year_Ranking, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = Same_School_Year_Ranking),
             data = ACSData10, color="black", alpha = .4, size = .2)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = Same_School_Year_Ranking),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .763, .682, .59, .59, .558, .316, .294, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('School District State Rank, Same Year, by Census Tract, 2013')

describe(ACSData10$Last_School_Year_Ranking, na.rm = TRUE)
quantile(ACSData10$Last_School_Year_Ranking, c(.875, .75, .625, .5, .375, .25, .125), na.rm = TRUE)

ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = Last_School_Year_Ranking),
             data = ACSData10, color="black", alpha = .4, size = .2)

m5 <- ggmap(DenverMetroMap) + 
  geom_polygon(aes(x = long, y = lat, group=id, fill = Last_School_Year_Ranking),
             data = ACSData10, color="black", alpha = .4, size = .2) +
            scale_fill_gradientn(colours = c("red4", "red2", "red", "lightcoral", "lightblue3", "cyan4", "blue", "midnightblue"),
                       values = c(1, .768, .659, .601, .557, .263, .263, .220, 0)) +
  labs(x = 'Longitude', y = 'Latitude') + ggtitle('School District State Rank, Previous Year, by Census Tract, 2013')

m5



#################################
#

setwd('C:/Users/John/Denver_Housing_Project/ACS_Data/Final_Data')

load("ACSData9.RData")
load("ACSData10.RData")

# Identify and remove missing values from analysis

# which(! complete.cases(ACSData9))
# ACSData9[!complete.cases(ACSData9),]
# ACSData9nona <-na.omit(ACSData9$HouseValue_Median)

table(is.na(ACSData9$Median_House_Value))

# Noticing ten missing observations of median housing value, and taking out 
test <- subset(ACSData9, is.na(Median_House_Value)) # So you can look at the 2 observations missing this variable
ACSData9nona <- subset(ACSData9, !is.na(Median_House_Value)) 
table(is.na(ACSData9nona$Median_House_Value)) #Now no NA's in median housing value



# Create a training/test split of 70% train, 30% test

set.seed(1234)
ind <-sample(2,nrow(ACSData9nona), replace=TRUE, prob=c(0.7, 0.3))
ACSData9nona.training <-ACSData9nona[ind==1,]
ACSData9nona.test <-ACSData9nona[ind==2,]
summary(ACSData9nona.training)
table(is.na(ACSData9nona.training$Median_House_Value)) # 399 observations
table(is.na(ACSData9nona.test$Median_House_Value)) # 178 observations

save(ACSData9nona, file = "ACSData9nonatraining.RData")
save(ACSData9nona.training, file = "ACSData9nona.training.RData")
save(ACSData9nona.test, file = "ACSData9nona.test.RData")



# Now, to test models using regression

setwd('C:/Users/John/Denver_Housing_Project/ACS_Data/Final_Data')
load("ACSData9nona.training.RData")
load("ACSData9nona.test.RData")

library(corrplot)
library(foreign)
library(glmnet)
library(broom)
library(foreign)
library(MASS)


model0 <- lm(Median_House_Value ~ 
                          HHInc12Mos_Perc5to9K +
                          HHInc12Mos_Perc5to9K_Owner +
                          HHInc12Mos_Perc10to14K +
                          HHInc12Mos_Perc10to14K_Owner +
                          HHInc12Mos_Perc15to20K +
                          HHInc12Mos_Perc15to20K_Owner +
                          HHInc12Mos_Perc20to25K +
                          HHInc12Mos_Perc20to25K_Owner +
                          HHInc12Mos_Perc25to35K +
                          HHInc12Mos_Perc25to35K_Owner +
                          HHInc12Mos_Perc35to50K +
                          HHInc12Mos_Perc35to50K_Owner +
                          HHInc12Mos_Perc50to75K +
                          HHInc12Mos_Perc50to75K_Owner +
                          HHInc12Mos_Perc75to100K +
                          HHInc12Mos_Perc75to100K_Owner +
                          HHInc12Mos_Perc100to150K +
                          HHInc12Mos_Perc100to150K_Owner +
                          HHInc12Mos_Perc150KPlus +
                          HHInc12Mos_Perc150KPlus_Owner,
                  data = ACSData9nona.training)
# make predictions and summarize accuracy
predictions0 <- predict(model0, ACSData9nona.training)
str(predictions0)
 

model0.res = resid(model0)
summary(model0)
AIC(model0)
BIC(model0)
summary(model0.res)


opar <- par(mfrow = c(2,2), oma = c(0, 0, 1.1, 0))
plot(model0, las = 1)

# Checking for influence and leverage

cooksd0 <-cooks.distance(model0)
stdresd0 <-stdres(model0)
dfbeta0 <-dfbetas(model0)
dffit0 <-dffits(model0)
influence0 <-influence.measures(model0)
a <-cbind(cooksd0, ACSData9nona.training)
a[c(1:5)]
a[cooksd0>4/399, c(1:6)]
# rstudent (model0)
# dffits   (model0)
# dfbetas  (model0)
# covratio (model0)
# cooks.distance(model0)
# Check largest cooks

model1 <- lm(Median_House_Value ~ 
                  HHInc12Mos_Owner_Perc25KandBelow +
                  HHInc12Mos_Owner_Perc75KandAbove +
                  HHs_Perc_MarriedCoupleFamilyOnly +
                  SCs_IndIncome_MedianIncome +
                  SCs_PercAtLeastBADegree +
                  SCs_PercUpto150PercentPovertyLevel +
                  HousingUnits_Perc_Vacant +
                  TvRO_Perc_Renter +
                  MeanHrsWorked +
                  Last_School_Year_Ranking,
                  data = ACSData9nona.training)


# make predictions and summarize accuracy
predictions1 <- predict(model1, ACSData9nona.training)
str(predictions1)
 

model1.res = resid(model1)
summary(model1)
AIC(model1)
BIC(model1)
summary(model1.res)


opar <- par(mfrow = c(2,2), oma = c(0, 0, 1.1, 0))
plot(model1, las = 1)

# Checking for influence and leverage

cooksd <-cooks.distance(model1)
stdresd <-stdres(model1)
dfbeta <-dfbetas(model1)
dffit <-dffits(model1)
influence <-influence.measures(model1)
a <-cbind(cooksd, ACSData9nona.training)
a[c(1:5)]
a[cooksd>4/399, c(1:6)]
# rstudent (model1)
# dffits   (model1)
# dfbetas  (model1)
# covratio (model1)
# cooks.distance(model1)
# Check largest cooks

ACSData9nona.training[c(145, 138, 417, 330, 319, 104, 415, 447, 312, 437, 109, 438, 476, 283, 2, 365, 242, 55, 578, 100, 163, 353, 421, 186, 270, 278, 156, 216, 191, 35, 182), 1:5]


# Dropping percent owners below $25K and last year's school district ranking


model2 <- lm(Median_House_Value ~ 
                  HHInc12Mos_Owner_Perc75KandAbove +
                  HHs_Perc_MarriedCoupleFamilyOnly +
                  SCs_IndIncome_MedianIncome +
                  SCs_PercAtLeastBADegree +
                  SCs_PercUpto150PercentPovertyLevel +
                  HousingUnits_Perc_Vacant +
                  TvRO_Perc_Renter +
                  MeanHrsWorked,
                  data = ACSData9nona.training)

summary(model2)
AIC(model2)
BIC(model2)

opar <- par(mfrow = c(2,2), oma = c(0, 0, 1.1, 0))
plot(model2, las = 1)

cooksd <-cooks.distance(model2)
stdresd <-stdres(model2)
dfbeta <-dfbetas(model2)
dffit <-dffits(model2)
influence <-influence.measures(model2)
a <-cbind(cooksd, ACSData9nona.training)
a[c(1:5)]
a[cooksd>4/399, c(1:6)]
#rstudent (model2)
#dffits   (model2)
#dfbetas  (model2)
#covratio (model2)
#cooks.distance(model2)



# Also dropping median house year


model3 <- lm(Median_House_Value ~ 
                  HHInc12Mos_Owner_Perc75KandAbove +
                  HHs_Perc_MarriedCoupleFamilyOnly +
                  SCs_IndIncome_MedianIncome +
                  SCs_PercAtLeastBADegree +
                  SCs_PercUpto150PercentPovertyLevel +
                  HousingUnits_Perc_Vacant +
                  TvRO_Perc_Renter +
                  MeanHrsWorked,
                  data = ACSData9nona.training)


summary(model3)
AIC(model3)
BIC(model3)

opar <- par(mfrow = c(2,2), oma = c(0, 0, 1.1, 0))
plot(model3, las = 1)

#########################
#
#
# Create smaller dataset to check for collinearity between variables



# ACSData11 <-select(data = ACSData9nona.training,
#                  'Median_House_Value', 
#                  'HHInc12Mos_Owner_Perc25KandBelow',
#                  'HHInc12Mos_Owner_Perc75KandAbove',
#                  'HHs_Perc_MarriedCoupleFamilyOnly',
#                  'SCs_IndIncome_MedianIncome',
#                  'SCs_PercAtLeastBADegree',
#                  'SCs_PercUpto150PercentPovertyLevel',
#                  'HousingUnits_Perc_Vacant',
#                  'TvRO_Perc_Renter',
#                  'MeanHrsWorked',
#                  'Last_School_Year_Ranking')

############################
#
#
#  Try LASSO regression to reduce multicollinearity

library(glmnet)

# How many missing values in median house value for training dataset

# sum(is.na(ACSData9.training$HouseValue_Median))
# ACSData9.training=na.omit(ACSData9.training$HouseValue_Median)
# str(ACSData9.training)

x=model.matrix(Median_House_Value ~ 
                  HHInc12Mos_Owner_Perc25KandBelow +
                  HHInc12Mos_Owner_Perc75KandAbove +
                  HHs_Perc_MarriedCoupleFamilyOnly +
                  SCs_IndIncome_MedianIncome +
                  SCs_PercAtLeastBADegree +
                  SCs_PercUpto150PercentPovertyLevel +
                  HousingUnits_Perc_Vacant +
                  TvRO_Perc_Renter +
                  MeanHrsWorked +
                  Last_School_Year_Ranking,
                  data = ACSData9nona.training)


summary(x)
y=ACSData9nona.training$Median_House_Value
summary(y)
fit.lasso=glmnet(x,y,alpha=1)
plot(fit.lasso,xvar="lambda",label=TRUE)
cv.lasso=cv.glmnet(x,y)
plot(cv.lasso)
coef(cv.lasso)
summarise(ACSData9nona.training)
summarise(ACSData9nona)

summary(ACSData9nona$HouseValue_Median)


```

